<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URBA.AI - Solutions IA pour l'Architecture & l'Urbanisme</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #141420;
            --bg-tertiary: #1a1a2e;
            --accent-primary: #6366f1;
            --accent-secondary: #818cf8;
            --accent-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --text-tertiary: #6b7280;
            --border-color: rgba(255, 255, 255, 0.1);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 5px;
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
            padding: 1rem 0;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.3s;
        }

        .nav-link:hover {
            color: var(--text-primary);
        }

        .nav-button {
            background: var(--accent-gradient);
            color: white;
            padding: 0.6rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.3s;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        /* Main Layout */
        .main-container {
            display: flex;
            height: 100vh;
            padding-top: 80px;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 2rem 1rem;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-tertiary);
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
        }

        .project-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .project-card:hover {
            border-color: var(--accent-primary);
            transform: translateX(5px);
        }

        .project-card.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .project-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .project-info {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
        }

        .chat-header {
            background: var(--bg-secondary);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .icon-button {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .icon-button:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        /* Messages */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
        }

        .message {
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .message-content {
            max-width: 70%;
            background: var(--bg-secondary);
            padding: 1rem 1.5rem;
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        .user .message-content {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        /* Study Results */
        .study-results {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .results-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .export-button {
            background: var(--accent-gradient);
            color: white;
            padding: 0.5rem 1.2rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .export-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.3);
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
        }

        .data-table th {
            background: var(--bg-secondary);
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .data-table td {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            font-size: 0.875rem;
        }

        .data-table tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.2rem;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* Input Area */
        .input-area {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 1.5rem 2rem;
        }

        .input-wrapper {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            font-size: 0.95rem;
            font-family: inherit;
            resize: none;
            outline: none;
            transition: all 0.3s;
        }

        .chat-input:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .input-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-button {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-button:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .send-button {
            background: var(--accent-gradient);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.3);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Right Panel */
        .right-panel {
            width: 320px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            padding: 2rem 1.5rem;
            overflow-y: auto;
        }

        .panel-section {
            margin-bottom: 2rem;
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .quick-action {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-action:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .quick-action-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .quick-action-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Loading Animation */
        .typing-indicator {
            display: flex;
            gap: 0.3rem;
            padding: 1rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-primary);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }
            .right-panel {
                display: none;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message {
            animation: fadeIn 0.3s ease-out;
        }

        /* 3D Volumetric Preview */
        .volumetric-preview {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            height: 300px;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .volumetric-canvas {
            width: 100%;
            height: 100%;
        }

        /* Upload Zone */
        .upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .upload-zone:hover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .upload-zone.dragover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-indicator.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status-indicator.warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .status-indicator.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            background: currentColor;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 currentColor;
            }
            70% {
                box-shadow: 0 0 0 6px rgba(0, 0, 0, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">URBA.AI</div>
            <div class="nav-links">
                <a href="#" class="nav-link">Solutions</a>
                <a href="#" class="nav-link">Tarifs</a>
                <a href="#" class="nav-link">Documentation</a>
                <a href="#" class="nav-link">Contact</a>
                <a href="#" class="nav-button">Connexion</a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Projets r√©cents</div>
                <div class="project-card active">
                    <div class="project-name">Tour Montparnasse 2</div>
                    <div class="project-info">Zone UC ‚Ä¢ 2,455 m¬≤</div>
                </div>
                <div class="project-card">
                    <div class="project-name">Eco-Quartier Lyon</div>
                    <div class="project-info">Zone UB ‚Ä¢ 15,320 m¬≤</div>
                </div>
                <div class="project-card">
                    <div class="project-name">R√©sidence Horizon</div>
                    <div class="project-info">Zone UA ‚Ä¢ 890 m¬≤</div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">Documents</div>
                <div class="upload-zone" id="uploadZone">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìÅ</div>
                    <div style="font-weight: 500; margin-bottom: 0.25rem;">Glisser vos documents</div>
                    <div style="font-size: 0.875rem; color: var(--text-secondary);">PLU, Plans, CAO</div>
                </div>
            </div>
        </aside>

        <!-- Chat Area -->
        <main class="chat-area">
            <div class="chat-header">
                <div>
                    <div class="chat-title">√âtude de faisabilit√© - Tour Montparnasse 2</div>
                    <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">
                        <span class="status-indicator success">
                            <span class="status-dot"></span>
                            IA Active
                        </span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="icon-button" title="Historique">üìä</button>
                    <button class="icon-button" title="Partager">üîó</button>
                    <button class="icon-button" title="Param√®tres">‚öôÔ∏è</button>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <div class="message">
                    <div class="avatar">AI</div>
                    <div class="message-content">
                        Bonjour ! Je suis URBA.AI, votre assistant sp√©cialis√© en urbanisme et architecture. 
                        
Je peux vous aider √† :
‚Ä¢ Analyser vos PLU et r√®glements d'urbanisme
‚Ä¢ G√©n√©rer des √©tudes de faisabilit√© compl√®tes
‚Ä¢ Calculer les surfaces constructibles et COS
‚Ä¢ Cr√©er des volum√©tries 3D r√©glementaires
‚Ä¢ V√©rifier la conformit√© de vos projets

Comment puis-je vous assister aujourd'hui ?
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div class="input-wrapper">
                    <textarea class="chat-input" id="chatInput" 
                        placeholder="D√©crivez votre projet ou posez une question..." 
                        rows="1"></textarea>
                    <div class="input-actions">
                        <button class="action-button" title="Joindre un fichier">üìé</button>
                        <button class="action-button" title="Commande vocale">üé§</button>
                    </div>
                    <button class="send-button" id="sendButton">
                        Analyser
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>
        </main>

        <!-- Right Panel -->
        <aside class="right-panel">
            <div class="panel-section">
                <div class="panel-title">Actions rapides</div>
                <div class="quick-actions">
                    <div class="quick-action" onclick="quickAction('feasibility')">
                        <div class="quick-action-icon">üìä</div>
                        <div class="quick-action-label">√âtude compl√®te</div>
                    </div>
                    <div class="quick-action" onclick="quickAction('cos')">
                        <div class="quick-action-icon">üìê</div>
                        <div class="quick-action-label">Calcul COS</div>
                    </div>
                    <div class="quick-action" onclick="quickAction('height')">
                        <div class="quick-action-icon">üìè</div>
                        <div class="quick-action-label">Hauteurs max</div>
                    </div>
                    <div class="quick-action" onclick="quickAction('3d')">
                        <div class="quick-action-icon">üèóÔ∏è</div>
                        <div class="quick-action-label">Volum√©trie 3D</div>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <div class="panel-title">Int√©grations</div>
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <button class="action-button" style="width: 100%; justify-content: center; display: flex; align-items: center; gap: 0.5rem;">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='16' height='16'%3E%3Cpath fill='%23ffffff' d='M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z'/%3E%3Cpath fill='%23ffffff' d='M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z'/%3E%3Cpath fill='%23ffffff' d='M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z'/%3E%3Cpath fill='%23ffffff' d='M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z'/%3E%3C/svg%3E" alt="Google Drive">
                        Google Drive
                    </button>
                    <button class="action-button" style="width: 100%; justify-content: center; display: flex; align-items: center; gap: 0.5rem;">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='16' height='16'%3E%3Cpath fill='%23ffffff' d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10h5v-2h-5c-4.34 0-8-3.66-8-8s3.66-8 8-8 8 3.66 8 8v1.43c0 .79-.71 1.57-1.5 1.57s-1.5-.78-1.5-1.57V12c0-2.76-2.24-5-5-5s-5 2.24-5 5 2.24 5 5 5c1.38 0 2.64-.56 3.54-1.47.65.89 1.77 1.47 2.96 1.47 1.97 0 3.5-1.6 3.5-3.57V12c0-5.52-4.48-10-10-10zm0 13c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z'/%3E%3C/svg%3E" alt="Outlook">
                        Outlook
                    </button>
                </div>
            </div>

            <div class="panel-section">
                <div class="panel-title">Ressources PLU</div>
                <div style="font-size: 0.875rem; color: var(--text-secondary); line-height: 1.6;">
                    Base de donn√©es nationale des PLU/PLUi avec mise √† jour automatique.
                    <div style="margin-top: 0.75rem;">
                        <a href="#" style="color: var(--accent-primary); text-decoration: none;">
                            Acc√©der √† la base ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // Configuration
        const API_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:8000'
            : 'https://striking-clarity-actelle.up.railway.app';

        // State
        let isLoading = false;
        let currentProject = {
            name: "Tour Montparnasse 2",
            zone: "UC",
            surface: 2455
        };

        // DOM Elements
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const messagesContainer = document.getElementById('messagesContainer');
        const uploadZone = document.getElementById('uploadZone');

        // Auto-resize textarea
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });

        // Send message on Enter
        chatInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Send button click
        sendButton.addEventListener('click', sendMessage);

        // Upload zone
        uploadZone.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pdf,.docx,.dwg,.dxf';
            input.multiple = true;
            input.onchange = handleFileUpload;
            input.click();
        });

        // Drag and drop
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFileUpload({ target: { files: e.dataTransfer.files } });
        });

        // Functions
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message || isLoading) return;

            isLoading = true;
            sendButton.disabled = true;

            // Add user message
            addMessage(message, 'user');
            chatInput.value = '';
            chatInput.style.height = 'auto';

            // Add typing indicator
            const typingId = addTypingIndicator();

            try {
                const response = await fetch(`${API_URL}/api/query`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: message,
                        project: currentProject
                    })
                });

                const data = await response.json();
                removeTypingIndicator(typingId);

                // Add AI response
                if (message.toLowerCase().includes('√©tude') || message.toLowerCase().includes('faisabilit√©')) {
                    addFeasibilityStudy();
                } else {
                    addMessage(data.answer || "Je traite votre demande...", 'ai');
                }

            } catch (error) {
                console.error('Error:', error);
                removeTypingIndicator(typingId);
                addMessage("D√©sol√©, une erreur s'est produite. Veuillez r√©essayer.", 'ai');
            } finally {
                isLoading = false;
                sendButton.disabled = false;
                chatInput.focus();
            }
        }

        function addMessage(content, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = sender === 'user' ? 'U' : 'AI';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.innerHTML = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function addTypingIndicator() {
            const id = Date.now();
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message';
            typingDiv.id = `typing-${id}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = 'AI';
            
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator';
            typingIndicator.innerHTML = `
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
            `;
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(typingIndicator);
            
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            return id;
        }

        function removeTypingIndicator(id) {
            const element = document.getElementById(`typing-${id}`);
            if (element) element.remove();
        }

        function addFeasibilityStudy() {
            const studyHTML = `
                <div>
                    <p>Voici l'√©tude de faisabilit√© compl√®te pour votre projet :</p>
                    
                    <div class="study-results">
                        <div class="results-header">
                            <div class="results-title">üìä Analyse r√©glementaire - Zone ${currentProject.zone}</div>
                            <button class="export-button" onclick="exportPDF()">üì• Export PDF</button>
                        </div>
                        
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-value">2,455 m¬≤</div>
                                <div class="metric-label">Surface parcelle</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">1,473 m¬≤</div>
                                <div class="metric-label">Emprise au sol max (60%)</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">3,682 m¬≤</div>
                                <div class="metric-label">Surface plancher max</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">15 m</div>
                                <div class="metric-label">Hauteur max (R+4)</div>
                            </div>
                        </div>
                        
                        <h4 style="margin: 1.5rem 0 1rem; font-size: 0.95rem;">Tableau d√©taill√© des surfaces</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Zone</th>
                                    <th>Surface terrain</th>
                                    <th>Emprise au sol</th>
                                    <th>Espaces verts</th>
                                    <th>COS</th>
                                    <th>Hauteur max</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>UC</td>
                                    <td>2,455 m¬≤</td>
                                    <td>60% (1,473 m¬≤)</td>
                                    <td>30% (736 m¬≤)</td>
                                    <td>1.5</td>
                                    <td>15m (R+4)</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h4 style="margin: 1.5rem 0 1rem; font-size: 0.95rem;">R√©partition par niveau</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Niveau</th>
                                    <th>Surface</th>
                                    <th>Usage</th>
                                    <th>Hauteur sous plafond</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>RDC</td>
                                    <td>1,473 m¬≤</td>
                                    <td>Commerce + Hall</td>
                                    <td>4.5m</td>
                                </tr>
                                <tr>
                                    <td>R+1 √† R+3</td>
                                    <td>1,350 m¬≤ / niveau</td>
                                    <td>Bureaux</td>
                                    <td>3.0m</td>
                                </tr>
                                <tr>
                                    <td>R+4</td>
                                    <td>1,200 m¬≤</td>
                                    <td>Bureaux + Terrasses</td>
                                    <td>3.0m</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="volumetric-preview">
                            <canvas class="volumetric-canvas" id="volumetricCanvas"></canvas>
                        </div>
                    </div>
                </div>
            `;
            
            addMessage(studyHTML, 'ai');
            
            // Initialize 3D preview
            setTimeout(init3DPreview, 100);
        }

        function init3DPreview() {
            const canvas = document.getElementById('volumetricCanvas');
            if (!canvas) return;
            
            // Simple 3D visualization placeholder
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // Draw simple building representation
            ctx.fillStyle = '#6366f1';
            ctx.fillRect(canvas.width/3, canvas.height/3, canvas.width/3, canvas.height/2);
            
            ctx.fillStyle = '#818cf8';
            ctx.fillRect(canvas.width/3 + 10, canvas.height/3 + 10, canvas.width/3 - 20, canvas.height/2 - 20);
            
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.strokeRect(canvas.width/3, canvas.height/3, canvas.width/3, canvas.height/2);
            
            ctx.font = '14px Inter';
            ctx.fillStyle = '#ffffff';
            ctx.textAlign = 'center';
            ctx.fillText('Volum√©trie 3D', canvas.width/2, canvas.height - 20);
        }

        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            files.forEach(file => {
                addMessage(`üìé Fichier "${file.name}" upload√© avec succ√®s. Analyse en cours...`, 'system');
                // Simulate processing
                setTimeout(() => {
                    addMessage(`‚úÖ Document "${file.name}" analys√© et index√© dans la base de connaissances.`, 'system');
                }, 2000);
            });
        }

        function quickAction(action) {
            const actions = {
                'feasibility': "G√©n√©rer une √©tude de faisabilit√© compl√®te pour ce projet",
                'cos': "Calculer le COS et les surfaces constructibles maximales",
                'height': "Quelle est la hauteur maximale autoris√©e sur cette parcelle ?",
                '3d': "Cr√©er une volum√©trie 3D r√©glementaire pour ce terrain"
            };
            
            if (actions[action]) {
                chatInput.value = actions[action];
                sendMessage();
            }
        }

        function exportPDF() {
            addMessage("üì• Export PDF en cours de g√©n√©ration...", 'system');
            setTimeout(() => {
                addMessage("‚úÖ √âtude de faisabilit√© export√©e avec succ√®s !", 'system');
            }, 2000);
        }

        // Add system message style
        const style = document.createElement('style');
        style.textContent = `
            .message.system .message-content {
                background: rgba(99, 102, 241, 0.1);
                border-color: var(--accent-primary);
                font-size: 0.875rem;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
